# See: https://sqlite.org/howtocompile.html
#
# Which basically gave me:
#
# gcc -DSQLITE_ENABLE_FTS4 -DSQLITE_ENABLE_FTS5 -DSQLITE_ENABLE_JSON1 \
#  -DSQLITE_ENABLE_RTREE -DSQLITE_ENABLE_EXPLAIN_COMMENTS -DHAVE_USLEEP \
#  -DHAVE_READLINE shell.c sqlite3.c -lreadline -lpthread -ldl -lm -I. \
#  -o  sqlite3-shell
#
# Though they'd forgotten -lm

CC = gcc
LD = gcc

#CFLAGS = -W -Wall -O2 -DYYSTACKDEPTH=4096 -DSQLITE_ENABLE_EXPLAIN_COMMENTS -DHAVE_USLEEP -DHAVE_READLINE -DSQLITE_THREADSAFE=0 -DSQLITE_DEFAULT_MEMSTATUS=0 -DSQLITE_DEFAULT_WAL_SYNCHRONOUS=1 -DSQLITE_MAX_EXPR_DEPTH=0 -DSQLITE_LIKE_DOESNT_MATCH_BLOBS -DSQLITE_OMIT_DEPRECATED -DSQLITE_OMIT_DECLTYPE -DSQLITE_OMIT_PROGRESS_CALLBACK -DSQLITE_OMIT_SHARED_CACHE -DSQLITE_USE_ALLOCA -I./
CFLAGS = -W -Wall -O2 -DYYSTACKDEPTH=4096 -DSQLITE_ENABLE_EXPLAIN_COMMENTS -DHAVE_USLEEP -DHAVE_READLINE -DSQLITE_THREADSAFE=0 -DSQLITE_DEFAULT_MEMSTATUS=0 -DSQLITE_DEFAULT_WAL_SYNCHRONOUS=1 -DSQLITE_MAX_EXPR_DEPTH=0 -DSQLITE_LIKE_DOESNT_MATCH_BLOBS -DSQLITE_OMIT_DEPRECATED -DSQLITE_OMIT_DECLTYPE -DSQLITE_OMIT_PROGRESS_CALLBACK -DSQLITE_OMIT_SHARED_CACHE -DSQLITE_USE_ALLOCA -I./
#LDFLAGS = -lreadline -lpthread -ldl -lm
LDFLAGS = -lpthread -ldl -lm
OBJ = sqlite3.o

.SUFFIXES: .c .h .o .so

all: $(OBJ)

.PHONY: shell
shell: sqlite3

sqlite3: shell.c sqlite3.c
	$(CC) -Os -I. $(CFLAGS) shell.c sqlite3.c -lncurses $(LDFLAGS) -o sqlite3

.c.o:
	$(CC) $(CFLAGS) -c $<

.PHONY: clean
clean:
	$(RM) $(OBJ) sqlite3

.PHONY: deepclean
deepclean: clean
	$(RM) *~

